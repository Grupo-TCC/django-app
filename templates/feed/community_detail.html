{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container">
  <div class="main-content">
    <div class="community-header" style="display: flex; align-items: center; gap: 16px; margin-bottom: 16px;">
      <h2 style="flex:1;">{{ community.name }}</h2>
      <button id="invite-members-btn" class="plus-btn" title="Adicionar membros">+</button>
    </div>
    <div class="community-description">
      <p>{{ community.description }}</p>
    </div>
    <div class="community-messages">
      <h3>Mensagens</h3>
      {% if error %}<div class="form-errors">{{ error }}</div>{% endif %}
      <form method="post" enctype="multipart/form-data" style="margin-bottom: 16px;">
        {% csrf_token %}
        <textarea name="message" rows="2" placeholder="Digite uma mensagem para todos os membros..." style="width:100%;"></textarea>
        <label for="pdf-upload" class="pdf-upload-label" style="cursor:pointer; color:#2ecc40; font-weight:bold; margin-right:8px;">+ PDF
          <input type="file" id="pdf-upload" name="pdf" accept="application/pdf" style="display:none;">
        </label>
        <button type="submit">Enviar</button>
      </form>
      <div class="messages-list">
        {% for msg in messages %}
          <div class="message-item">
            <strong>{{ msg.user.fullname }}</strong>:
            {% if msg.body %}{{ msg.body }}{% endif %}
            {% if msg.pdf %}<a href="{{ msg.pdf.url }}" target="_blank">[PDF]</a>{% endif %}
          </div>
        {% empty %}
          <p>Nenhuma mensagem ainda.</p>
        {% endfor %}
      </div>
    </div>
    <!-- Modal para convidar membros -->
    <div id="invite-modal" class="modal" style="display:none;">
      <div class="modal-content">
        <span class="close-modal" id="close-invite-modal">&times;</span>
        <h4>Convidar pessoas que você segue</h4>
        <ul>
          {% for user in possible_invites %}
            <li>{{ user.fullname }} <form method="get" style="display:inline;"><input type="hidden" name="invite" value="{{ user.id }}"><button type="submit">Convidar</button></form></li>
          {% empty %}
            <li>Você já convidou todos que segue.</li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>
</div>
<script>
  document.getElementById('invite-members-btn').onclick = function() {
    document.getElementById('invite-modal').style.display = 'block';
  };
  document.getElementById('close-invite-modal').onclick = function() {
    document.getElementById('invite-modal').style.display = 'none';
  };
</script>
{% endblock %}
