{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Perfil - Innovator</title>
  <link rel="stylesheet" href="{% static 'styles/home.css' %}">
  <style>
    /* Força o modal a cobrir tudo, inclusive overlays de artigos */
    #profile-img-modal {
      display: none;
      position: fixed !important;
      z-index: 2147483647 !important;
      left: 0;
      top: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.88);
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }
    #profile-img-modal[style*="display: flex"] {
      display: flex !important;
    }
    #profile-img-modal img {
      max-width: 90vw;
      max-height: 90vh;
      border-radius: 10px;
      box-shadow: 0 4px 24px rgba(0,0,0,0.25);
      display: block;
      margin: auto;
      position: relative;
      z-index: 2147483648;
    }
    body.modal-open {
      overflow: hidden !important;
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav>
    <div class="nav-left">
      <a href="{% url 'feed:artigos' %}"><img src="{% static 'assets/img/logo.png' %}" class="logo"></a>
      <ul>
        <li><img src="{% static 'assets/img/notification.png' %}"></li>
        <li><a href="{% url 'feed:mensagens' %}"><img src="{% static 'assets/img/inbox.png' %}" alt="Mensagens" style="cursor:pointer;"></a></li>
      </ul>
    </div>
    <div class="nav-right">
      <form class="search-box" method="get" action="">
        <img src="{% static 'assets/img/search.png' %}">
        <input type="text" name="q" placeholder="Pesquisar artigos, pesquisadores ou áreas" value="">
      </form>
      <div class="nav-user-icon online" onclick="settingsMenuToggle()">
        <img src="{{ profile_user.get_profile_picture_url }}">
      </div>
      <div class="settings-menu">
        <div id="dark-btn"><span></span></div>
        <div class="settings-menu-inner">
          <div class="user-profile">
            <img src="{{ profile_user.get_profile_picture_url }}">
            <div>
              <p>{{ profile_user.fullname }}</p>
              <a href="{% url 'feed:perfil' %}">Ver Perfil</a>
            </div>
          </div>
          <hr>
          <div class="user-profile">
            <img src="{% static 'assets/img/feedback.png' %}">
            <div>
              <p>Nos dê seu feedback</p>
              <a href="#">Ajude a melhorar nosso site</a>
            </div>
          </div>
          <hr>
          <div class="settings-links">
            <img src="{% static 'assets/img/setting.png' %}" class="settings-icon">
            <a href="{% url 'feed:settings' %}">Configuração & Privacidade <img src="{% static 'assets/img/arrow.png' %}" width="10px"></a>
          </div>
          <div class="settings-links">
            <img src="{% static 'assets/img/help.png' %}" class="settings-icon">
            <a href="#">Ajuda <img src="{% static 'assets/img/arrow.png' %}" width="10px"></a>
          </div>
          <div class="settings-links">
            <img src="{% static 'assets/img/logout.png' %}" class="settings-icon">
            <a href="{% url 'logout' %}">Sair <img src="{% static 'assets/img/arrow.png' %}" width="10px"></a>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <div class="container">
    <!-- LEFT SIDEBAR -->
    <div class="left-sidebar">
      <style>
        .imp-links a {
          display: flex;
          align-items: center;
          padding: 10px 16px;
          border-left: 4px solid transparent;
          color: #256d4a !important;
          text-decoration: none;
          font-weight: 500;
          background: none;
          transition: background 0.2s, border-color 0.2s, color 0.2s;
        }
        .imp-links a.active {
          background: #eafaf1;
          border-left: 4px solid #28a745;
          color: #28a745 !important;
        }
        .imp-links a img {
          margin-right: 10px;
        }
      </style>
      <div class="imp-links">
        <a href="{% url 'feed:artigos' %}" class="{% if request.resolver_match.url_name == 'artigos' %}active{% endif %}"><img src="{% static 'assets/img/newspaper.png' %}"> Artigos Científicos</a>
        <a href="{% url 'feed:conexao' %}" class="{% if request.resolver_match.url_name == 'conexao' %}active{% endif %}"><img src="{% static 'assets/img/friends.png' %}"> Conexões</a>
        <a href="{% url 'feed:community' %}" class="{% if request.resolver_match.url_name == 'community' %}active{% endif %}"><img src="{% static 'assets/img/people.png' %}"> Comunidades</a>
      </div>
    </div>

    <!-- MAIN CONTENT -->
    <div class="main-content" style="margin: 0 auto; float: none; display: flex; flex-direction: column; align-items: center;">
      <!-- Bloco de perfil restaurado -->
      <div class="post-container" style="text-align:center; padding:0; overflow:visible;">
        <!-- Capa verde escuro -->
        <div style="background:#256d4a; height:120px; border-top-left-radius:10px; border-top-right-radius:10px; position:relative;">
          <!-- Foto de perfil -->
          <img src="{{ profile_user.get_profile_picture_url }}" alt="Foto de perfil" style="width: 120px; height: 120px; border-radius: 50%; border:4px solid #fff; position:absolute; left:50%; transform:translateX(-50%); bottom:-60px; box-shadow:0 2px 8px rgba(0,0,0,0.10); background:#fff;">
          <img src="{{ profile_user.get_profile_picture_url }}" alt="Foto de perfil" id="profile-header-img" style="width: 120px; height: 120px; border-radius: 50%; border:4px solid #fff; position:absolute; left:50%; transform:translateX(-50%); bottom:-60px; box-shadow:0 2px 8px rgba(0,0,0,0.10); background:#fff; cursor:pointer;">

          <!-- Modal para imagem inteira -->

        </div>
        <!-- Nome do usuário -->
        <div id="profile-name" style="font-size:1.4em; font-weight:700; color:#222; margin-top:80px;">{{ profile_user.fullname }}</div>
        <!-- Título e instituição -->
        <div id="profile-title" style="font-size:1.1em; color:#256d4a; margin-top:4px;">
          {% if profile_user.research_area %}
            {{ profile_user.research_area }}
          {% else %}
            <span style="color:#bbb;">adicione um título</span>
          {% endif %}
        </div>
        <div id="profile-university" style="font-size:1em; color:#555; margin-bottom:10px;">
          {% if profile_user.institution %}
            {{ profile_user.institution }}
          {% else %}
            <span style="color:#bbb;">adicione instituição</span>
          {% endif %}
        </div>
      </div>

      <div class="post-container" style="margin-top:32px;">
        <h2 style="color:#256d4a;">Seus Artigos</h2>
        {% if user_articles %}
          <ul style="list-style:none;padding:0;">
            {% for article in user_articles %}
              <li style="margin-bottom:18px; padding:16px; border:1px solid #e0e0e0; border-radius:8px; background:#fafafa; position:relative;">
                <div style="font-size:1.1em; font-weight:600; color:#256d4a;">{{ article.title }}</div>
                <div style="font-size:0.95em; color:#555; margin:4px 0 8px 0;">{{ article.research_area }}</div>
                {% if article.description %}
                  <div class="article-description" style="font-size:0.97em; color:#333; margin-bottom:8px; position:relative;">
                    <span class="desc-text" style="display:inline;">
                      {% if article.description|length > 220 %}
                        <span class="desc-short">{{ article.description|slice:':220' }}...</span>
                        <span class="desc-full" style="display:none;">{{ article.description }}</span>
                        <button class="desc-toggle" onclick="toggleDesc(this); return false;" style="background:none;border:none;color:#28a745;cursor:pointer;padding:0;">mais</button>
                      {% else %}
                        {{ article.description }}
                      {% endif %}
                    </span>
                  </div>
                {% endif %}
                <a href="{{ article.pdf.url }}" target="_blank" style="color:#28a745; font-weight:500; text-decoration:underline;">Ver PDF</a>
                <form method="post" action="{% url 'feed:delete_article' article.id %}" style="position:absolute; top:12px; right:12px;">
                  {% csrf_token %}
                  <button type="submit" style="background:#fff; color:#d32f2f; border:1px solid #d32f2f; border-radius:4px; padding:2px 10px; font-size:13px; cursor:pointer;">Apagar</button>
                </form>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p style="color:#888;">Você ainda não publicou nenhum artigo.</p>
        {% endif %}
      </div>
      <script>
      function toggleDesc(btn) {
        var card = btn.closest('.article-description');
        var shortDesc = card.querySelector('.desc-short');
        var fullDesc = card.querySelector('.desc-full');
        if (shortDesc.style.display !== 'none') {
          shortDesc.style.display = 'none';
          fullDesc.style.display = 'inline';
          btn.textContent = 'menos';
          btn.style.color = '#28a745';
        } else {
          shortDesc.style.display = 'inline';
          fullDesc.style.display = 'none';
          btn.textContent = 'mais';
          btn.style.color = '#28a745';
        }
      }

      // Modal da imagem de perfil
      document.addEventListener('DOMContentLoaded', function() {
        var img = document.getElementById('profile-header-img');
        var modal = document.getElementById('profile-img-modal');
        if (img && modal) {
          img.onclick = function() {
            modal.style.display = 'flex';
            document.body.classList.add('modal-open');
          };
          modal.onclick = function(e) {
            if (e.target === modal) {
              modal.style.display = 'none';
              document.body.classList.remove('modal-open');
            }
          };
        }
      });
      </script>
    </div>
    <!-- Fim main-content -->

    <!-- Right Sidebar invisível -->
    <div class="right-sidebar" style="visibility:hidden; opacity:0; pointer-events:none;"></div>
  </div>
  <div class="footer"><p>Innovator 2025</p></div>
  <!-- Modal para imagem inteira -->
  <div id="profile-img-modal" style="display:none; position:fixed; z-index:2147483647 !important; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.92); align-items:center; justify-content:center; flex-direction:column;">
    <img src="{{ profile_user.get_profile_picture_url }}" alt="Foto de perfil inteira" style="max-width:90vw; max-height:90vh; border-radius:10px; box-shadow:0 4px 24px rgba(0,0,0,0.25); display:block; margin:auto; position:relative; z-index:2147483648;">
  </div>
  <script src="{% static 'js/home.js' %}"></script>
</body>
</html>
