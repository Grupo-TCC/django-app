{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Perfil - Innovator</title>
  <link rel="stylesheet" href="{% static 'styles/home.css' %}">
  <style>
    /* For√ßa o modal a cobrir tudo, inclusive overlays de artigos */
    #profile-img-modal {
      display: none;
      position: fixed !important;
      z-index: 2147483647 !important;
      left: 0;
      top: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.88);
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }
    #profile-img-modal[style*="display: flex"] {
      display: flex !important;
    }
    #profile-img-modal img {
      max-width: 90vw;
      max-height: 90vh;
      border-radius: 10px;
      box-shadow: 0 4px 24px rgba(0,0,0,0.25);
      display: block;
      margin: auto;
      position: relative;
      z-index: 2147483648;
    }
    body.modal-open {
      overflow: hidden !important;
    }
  </style>
</head>
<body>
  {% include 'components/topbar.html' %}

  <div class="container">
    {% include 'components/sidebar.html' %}

    <!-- MAIN CONTENT -->
    <div class="main-content" style="margin: 0 auto; float: none; display: flex; flex-direction: column; align-items: center;">
      <!-- Bloco de perfil restaurado -->
      <div class="post-container" style="text-align:center; padding:0; overflow:visible;">
        <!-- Capa verde escuro -->
        <div style="background:#256d4a; height:120px; border-top-left-radius:10px; border-top-right-radius:10px; position:relative;">
          <!-- Foto de perfil -->
          <img src="{{ profile_user.get_profile_picture_url }}" alt="Foto de perfil" style="width: 120px; height: 120px; border-radius: 50%; border:4px solid #fff; position:absolute; left:50%; transform:translateX(-50%); bottom:-60px; box-shadow:0 2px 8px rgba(0,0,0,0.10); background:#fff;">
          <img src="{{ profile_user.get_profile_picture_url }}" alt="Foto de perfil" id="profile-header-img" style="width: 120px; height: 120px; border-radius: 50%; border:4px solid #fff; position:absolute; left:50%; transform:translateX(-50%); bottom:-60px; box-shadow:0 2px 8px rgba(0,0,0,0.10); background:#fff; cursor:pointer;">

          <!-- Modal para imagem inteira -->

        </div>
        <!-- Nome do usu√°rio -->
        <div id="profile-name" style="font-size:1.4em; font-weight:700; color:#222; margin-top:80px;">{{ profile_user.fullname }}</div>
        <!-- T√≠tulo e institui√ß√£o -->
        <div id="profile-title" style="font-size:1.1em; color:#256d4a; margin-top:4px;">
          {% if profile_user.research_area %}
            {{ profile_user.research_area }}
          {% else %}
            <span style="color:#bbb;">adicione um t√≠tulo</span>
          {% endif %}
        </div>
        <div id="profile-university" style="font-size:1em; color:#555; margin-bottom:10px;">
          {% if profile_user.institution %}
            {{ profile_user.institution }}
          {% else %}
            <span style="color:#bbb;">adicione institui√ß√£o</span>
          {% endif %}
        </div>
        <!-- Localiza√ß√£o -->
        {% if profile_user.cidade or profile_user.estado %}
        <div id="profile-location" style="font-size:0.9em; color:#666; margin-bottom:10px;">
          üìç {% if profile_user.cidade %}{{ profile_user.cidade }}{% endif %}{% if profile_user.cidade and profile_user.estado %}, {% endif %}{% if profile_user.estado %}{{ profile_user.estado }}{% endif %}
        </div>
        {% endif %}
      </div>

      <div class="post-container" style="margin-top:32px;">
        <h2 style="color:#256d4a;">Seus Artigos</h2>
        {% if user_articles %}
          <ul style="list-style:none;padding:0;">
            {% for article in user_articles %}
              <li style="margin-bottom:18px; padding:16px; border:1px solid #e0e0e0; border-radius:8px; background:#fafafa; position:relative;">
                <div style="font-size:1.1em; font-weight:600; color:#256d4a;">{{ article.title }}</div>
                <div style="font-size:0.95em; color:#555; margin:4px 0 8px 0;">{{ article.research_area }}</div>
                {% if article.description %}
                  <div class="article-description" style="font-size:0.97em; color:#333; margin-bottom:8px; position:relative;">
                    <span class="desc-text" style="display:inline;">
                      {% if article.description|length > 220 %}
                        <span class="desc-short">{{ article.description|slice:':220' }}...</span>
                        <span class="desc-full" style="display:none;">{{ article.description }}</span>
                        <button class="desc-toggle" onclick="toggleDesc(this); return false;" style="background:none;border:none;color:#28a745;cursor:pointer;padding:0;">mais</button>
                      {% else %}
                        {{ article.description }}
                      {% endif %}
                    </span>
                  </div>
                {% endif %}
                {% if article.get_pdf_url %}
                <a href="{{ article.get_pdf_url }}" target="_blank" style="color:#28a745; font-weight:500; text-decoration:underline;">Ver PDF</a>
                {% else %}
                <span style="color: #888; font-style: italic;">PDF n√£o dispon√≠vel</span>
                {% endif %}
                <form method="post" action="{% url 'feed:delete_article' article.id %}" style="position:absolute; top:12px; right:12px;">
                  {% csrf_token %}
                  <button type="submit" style="background:#fff; color:#d32f2f; border:1px solid #d32f2f; border-radius:4px; padding:2px 10px; font-size:13px; cursor:pointer;">Apagar</button>
                </form>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p style="color:#888;">Voc√™ ainda n√£o publicou nenhum artigo.</p>
        {% endif %}
      </div>
      <script>
      function toggleDesc(btn) {
        var card = btn.closest('.article-description');
        var shortDesc = card.querySelector('.desc-short');
        var fullDesc = card.querySelector('.desc-full');
        if (shortDesc.style.display !== 'none') {
          shortDesc.style.display = 'none';
          fullDesc.style.display = 'inline';
          btn.textContent = 'menos';
          btn.style.color = '#28a745';
        } else {
          shortDesc.style.display = 'inline';
          fullDesc.style.display = 'none';
          btn.textContent = 'mais';
          btn.style.color = '#28a745';
        }
      }

      // Modal da imagem de perfil
      document.addEventListener('DOMContentLoaded', function() {
        var img = document.getElementById('profile-header-img');
        var modal = document.getElementById('profile-img-modal');
        if (img && modal) {
          img.onclick = function() {
            modal.style.display = 'flex';
            document.body.classList.add('modal-open');
          };
          modal.onclick = function(e) {
            if (e.target === modal) {
              modal.style.display = 'none';
              document.body.classList.remove('modal-open');
            }
          };
        }
      });
      </script>
    </div>
    <!-- Fim main-content -->

    <!-- Right Sidebar invis√≠vel -->
    <div class="right-sidebar" style="visibility:hidden; opacity:0; pointer-events:none;"></div>
  </div>
  <div class="footer"><p>Innovator 2025</p></div>
  <!-- Modal para imagem inteira -->
  <div id="profile-img-modal" style="display:none; position:fixed; z-index:2147483647 !important; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.92); align-items:center; justify-content:center; flex-direction:column;">
    <img src="{{ profile_user.get_profile_picture_url }}" alt="Foto de perfil inteira" style="max-width:90vw; max-height:90vh; border-radius:10px; box-shadow:0 4px 24px rgba(0,0,0,0.25); display:block; margin:auto; position:relative; z-index:2147483648;">
  </div>
    <script src="{% static 'js/home.js' %}"></script>

</body>
</html>
