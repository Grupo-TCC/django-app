<!-- prettier-ignore-start -->
{% load static %}
{% load custom_filters %}
<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Produtos para Sa√∫de - Innovator</title>
    <link rel="stylesheet" href="{% static 'styles/home.css' %}" />
    <link rel="stylesheet" href="{% static 'styles/artigos.css' %}" />
  </head>
  <body>
    {% include 'components/topbar.html' %}

    <div class="container">
      {% include 'components/sidebar.html' %}

      <!-- MAIN CONTENT -->
      <div class="main-content">
        
        <div class="artigos-header">
          <form method="get" class="search-box search-form" style="flex: 1">
            <input
              type="text"
              id="search-input"
              name="q"
              placeholder="Pesquisar por pesquisador, t√≠tulo ou descri√ß√£o"
              value="{{ search_query|default:'' }}"
              style="width: 100%; border: 1px solid #ccc; border-radius: 20px; padding: 10px 16px; outline: none;"
            />
          </form>
          <button
            id="add-product-btn"
            class="plus-btn"
            title="Adicionar produto"
          >
            <span>+</span>
          </button>
        </div>
        
        <!-- Product Modal -->
        <div id="product-modal" class="post-modal" style="display: none">
          <div class="post-modal-content">
            <span class="close-modal" id="close-product-modal">&times;</span>
            <h3>Publicar Novo Produto</h3>
            <form
              method="POST"
              id="product-upload-form"
            >
              {% csrf_token %} 
              {% if form.non_field_errors %}
                <div class="form-errors">{{ form.non_field_errors }}</div>
              {% endif %}

              <div class="form-group">
                <label for="{{ form.titulo.id_for_label }}">T√≠tulo do Produto:</label>
                {{ form.titulo }} 
                {% if form.titulo.errors %}
                  <div class="field-errors">{{ form.titulo.errors }}</div>
                {% endif %}
              </div>

              <div class="form-group">
                <label for="{{ form.descricao.id_for_label }}">Descri√ß√£o:</label>
                {{ form.descricao }} 
                {% if form.descricao.errors %}
                  <div class="field-errors">{{ form.descricao.errors }}</div>
                {% endif %}
              </div>

              <div class="form-group">
                <label for="{{ form.area_pesquisa.id_for_label }}">√Årea de Pesquisa:</label>
                {{ form.area_pesquisa }} 
                {% if form.area_pesquisa.errors %}
                  <div class="field-errors">{{ form.area_pesquisa.errors }}</div>
                {% endif %}
              </div>

              <div class="form-group">
                <label for="{{ form.link.id_for_label }}">Link do Produto:</label>
                {{ form.link }} 
                {% if form.link.errors %}
                  <div class="field-errors">{{ form.link.errors }}</div>
                {% endif %}
              </div>

              <div class="form-actions">
                <button type="button" id="cancel-product" class="btn-cancel">
                  Cancelar
                </button>
                <button type="submit" class="btn-submit">
                  Publicar Produto
                </button>
              </div>
            </form>
          </div>
        </div>
        
        <!-- Lista de produtos -->
        <div class="artigos-lista">
          {% for product in products %}
            <!-- Post -->
            <div class="post-container">
              <div class="post-row">
                <div class="user-profile">
                  <img src="{{ product.user.get_profile_picture_url }}" alt="{{ product.user.fullname }}">
                  <div>
                    <p>{{ product.user.fullname }}</p>
                    {% if product.user.innovator_verification and product.user.innovator_verification.title %}
                      <small>{{ product.user.innovator_verification.title }}</small>
                    {% else %}
                      <small>{{ product.user.research_area|default:"Pesquisador" }}</small>
                    {% endif %}
                    <small style="color: #666;">{{ product.created_at|date:"d/m/Y H:i" }}</small>
                  </div>
                </div>
              </div>
              <p class="post-text">{{ product.titulo }}</p>
              {% if product.descricao %}
                <div class="post-description">
                  <p>{{ product.descricao }}</p>
                </div>
              {% endif %}
              <small style="color: #666; display: block; margin: 10px 0;">
                üìÇ {{ product.get_area_pesquisa_display }}
              </small>
              
              <div class="post-activity">
                <a 
                  href="{{ product.link }}" 
                  target="_blank" 
                  rel="noopener noreferrer"
                  class="activity-link"
                  style="display: inline-block; padding: 8px 16px; background-color: #256d4a; color: white; text-decoration: none; border-radius: 4px; font-size: 14px;"
                >
                  üîó Acessar Produto
                </a>
              </div>
            </div>
          {% empty %}
            <div class="post-container">
              <p style="text-align: center; color: #666; padding: 40px;">
                Nenhum produto publicado ainda.
              </p>
            </div>
          {% endfor %}
        </div>
      </div>

      <!-- RIGHT SIDEBAR -->
      <div class="right-sidebar">
        <div class="sidebar-title-container">
          <h3>Pesquisadores Conectados</h3>
        </div>
        <div class="message-list">
          {% for user in top_message_users %}
          <div class="message-item">
            <div class="profile-pic-small">
              <img
                src="{% if user.profile_pic %}{{ user.profile_pic.url }}{% else %}{% static 'assets/img/profile-pic.png' %}{% endif %}"
                alt="Foto do Perfil"
              />
            </div>
            <div class="message-info">
              <p>{{ user.fullname }}</p>
              <span>{{ user.research_area|default:"√Årea n√£o especificada" }}</span>
            </div>
          </div>
          {% empty %}
          <p style="color: #888; font-size: 14px; text-align: center; padding: 20px;">
            Conecte-se com pesquisadores para v√™-los aqui.
          </p>
          {% endfor %}
        </div>
      </div>
    </div>

    <script>
      var settingsMenu = document.querySelector(".settings-menu");
      function settingsMenuToggle() {
        settingsMenu.classList.toggle("settings-menu-height");
      }

      // Notification dropdown toggle
      document.getElementById('notification-bell').addEventListener('click', function(e) {
        e.stopPropagation();
        var dropdown = document.getElementById('notification-dropdown');
        dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
      });

      // Close notification dropdown when clicking elsewhere
      document.addEventListener('click', function() {
        document.getElementById('notification-dropdown').style.display = 'none';
      });

      // Product modal handling
      document.getElementById('add-product-btn').addEventListener('click', function() {
        document.getElementById('product-modal').style.display = 'block';
      });

      document.getElementById('close-product-modal').addEventListener('click', function() {
        document.getElementById('product-modal').style.display = 'none';
      });

      document.getElementById('cancel-product').addEventListener('click', function() {
        document.getElementById('product-modal').style.display = 'none';
      });

      // Close modal when clicking outside
      window.addEventListener('click', function(event) {
        const modal = document.getElementById('product-modal');
        if (event.target === modal) {
          modal.style.display = 'none';
        }
      });
    </script>
  </body>
</html>
<!-- prettier-ignore-end -->