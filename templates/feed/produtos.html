<!-- prettier-ignore-start -->
{% load static %}
{% load custom_filters %}
<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Produtos para Sa√∫de - Innovasus</title>
    <link rel="stylesheet" href="{% static 'styles/home.css' %}" />
    <link rel="stylesheet" href="{% static 'styles/artigos.css' %}" />
    <!-- Icon libraries for sidebar -->
  <link rel="stylesheet" href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-pZfgb5iQ2c3F1ozz0Ix4do05k7OC5nL3qE+R1Yv4CM4eW9MuRGBnW3n3rMWYpuV8k2fMiYjVZZ3+5Rexm3dbZg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  </head>
  <body>
    {% include 'components/topbar.html' %}

    <div class="container">
      {% include 'components/sidebar.html' %}

      <!-- MAIN CONTENT -->
      <div class="main-content">
        
        <div class="artigos-header">
          <form method="get" class="search-box search-form" style="flex: 1">
            <input
              type="text"
              id="search-input"
              name="q"
              placeholder="Pesquisar por pesquisador, t√≠tulo ou descri√ß√£o"
              value="{{ search_query|default:'' }}"
              style="width: 100%; border: 1px solid #ccc; border-radius: 20px; padding: 10px 16px; outline: none;"
            />
          </form>
          <button
            id="add-product-btn"
            class="plus-btn"
            title="Adicionar produto"
          >
            <span>+</span>
          </button>
        </div>
        
        <!-- Product Modal -->
        <div id="product-modal" class="post-modal" style="display: none">
          <div class="post-modal-content">
            <span class="close-modal" id="close-product-modal">&times;</span>
            <h3>Publicar Novo Produto</h3>
            <form
              method="POST"
              id="product-upload-form"
              onsubmit="return handleProductFormSubmit(event)"
            >
              {% csrf_token %} 
              {% if form.non_field_errors %}
                <div class="form-errors">{{ form.non_field_errors }}</div>
              {% endif %}

              <div class="form-group">
                <label for="{{ form.titulo.id_for_label }}">T√≠tulo do Produto:</label>
                {{ form.titulo }} 
                {% if form.titulo.errors %}
                  <div class="field-errors">{{ form.titulo.errors }}</div>
                {% endif %}
              </div>

              <div class="form-group">
                <label for="{{ form.descricao.id_for_label }}">Descri√ß√£o:</label>
                {{ form.descricao }} 
                {% if form.descricao.errors %}
                  <div class="field-errors">{{ form.descricao.errors }}</div>
                {% endif %}
              </div>

              <div class="form-group">
                <label for="{{ form.research_area_select.id_for_label }}">√Årea de Pesquisa:</label>
                {{ form.research_area_select }} 
                {{ form.research_area_custom }} 
                {{ form.area_pesquisa }}
                {% if form.research_area_select.errors %}
                  <div class="field-errors">{{ form.research_area_select.errors }}</div>
                {% endif %}
                {% if form.research_area_custom.errors %}
                  <div class="field-errors">{{ form.research_area_custom.errors }}</div>
                {% endif %}
              </div>

              <div class="form-group">
                <label for="{{ form.link.id_for_label }}">Link do Produto:</label>
                {{ form.link }} 
                {% if form.link.errors %}
                  <div class="field-errors">{{ form.link.errors }}</div>
                {% endif %}
              </div>

              <div class="form-actions">
                <button type="button" id="cancel-product" class="btn-cancel">
                  Cancelar
                </button>
                <button type="submit" class="btn-submit">
                  Publicar Produto
                </button>
              </div>
            </form>
          </div>
        </div>
        
        <!-- Lista de produtos -->
        <div class="artigos-lista">
          {% for product in products %}
            <!-- Post -->
            <div class="post-container">
              <div class="post-row">
                <div class="user-profile">
                  <img src="{{ product.user.get_profile_picture_url }}" alt="{{ product.user.fullname }}">
                  <div>
                    <p><a href="{% url 'feed:perfil' product.user.id %}" class="user-name-link" title="Ver perfil">{{ product.user.fullname }}</a></p>
                    <div class="user-meta">
                      <small>{{ product.user.institution }},</small>
                      <small>{{ product.user.cidade }},</small>
                      <small>{{ product.user.estado }}</small>
                    </div>
                  </div>
                </div>
              </div>
              <p class="post-text">{{ product.titulo }}</p>
              {% if product.descricao %}
                <div class="post-description">
                  <p>{{ product.descricao }}</p>
                </div>
              {% endif %}
              <small style="color: #666; display: block; margin: 10px 0;">
                üìÇ {{ product.get_area_pesquisa_display }}
              </small>
              
              <div class="post-activity">
                <a 
                  href="{{ product.link }}" 
                  target="_blank" 
                  rel="noopener noreferrer"
                  class="activity-link"
                  style="display: inline-block; padding: 8px 16px; background-color: #256d4a; color: white; text-decoration: none; border-radius: 4px; font-size: 14px;"
                >
                  üîó Acessar Produto
                </a>
              </div>
            </div>
          {% empty %}
            <div class="post-container">
              <p style="text-align: center; color: #666; padding: 40px;">
                Nenhum produto publicado ainda.
              </p>
            </div>
          {% endfor %}
        </div>
      </div>

      <!-- RIGHT SIDEBAR -->
      {% include 'components/convo_rightbar.html' %}
    </div>

    <script>
      var settingsMenu = document.querySelector(".settings-menu");
      function settingsMenuToggle() {
        settingsMenu.classList.toggle("settings-menu-height");
      }



      // Product modal handling
      document.getElementById('add-product-btn').addEventListener('click', function() {
        document.getElementById('product-modal').style.display = 'block';
      });

      document.getElementById('close-product-modal').addEventListener('click', function() {
        document.getElementById('product-modal').style.display = 'none';
      });

      document.getElementById('cancel-product').addEventListener('click', function() {
        document.getElementById('product-modal').style.display = 'none';
      });

      // Close modal when clicking outside
      window.addEventListener('click', function(event) {
        const modal = document.getElementById('product-modal');
        if (event.target === modal) {
          modal.style.display = 'none';
        }
      });

      // Research area functionality (matching ProductForm custom IDs)
      document.addEventListener('DOMContentLoaded', function() {
        var researchAreaSelect = document.getElementById('research_area_select_product');
        var researchAreaCustom = document.getElementById('research_area_custom_product');
        var hiddenAreaPesquisa = document.getElementById('id_area_pesquisa');
        
        if (researchAreaSelect && researchAreaCustom) {
          function toggleCustomInput() {
            if (researchAreaSelect.value === 'outro') {
              researchAreaCustom.style.display = 'block';
              researchAreaCustom.required = true;
            } else {
              researchAreaCustom.style.display = 'none';
              researchAreaCustom.required = false;
              researchAreaCustom.value = '';
            }
          }
          
          // Initialize on page load
          toggleCustomInput();
          
          // Handle changes
          researchAreaSelect.addEventListener('change', toggleCustomInput);
          
          // Handle form submission to set the hidden field value
          var form = document.getElementById('product-upload-form');
          if (form) {
            form.addEventListener('submit', function() {
              if (researchAreaSelect.value === 'outro') {
                hiddenAreaPesquisa.value = researchAreaCustom.value;
              } else {
                // Find the display name for the selected choice
                var selectedOption = researchAreaSelect.options[researchAreaSelect.selectedIndex];
                hiddenAreaPesquisa.value = selectedOption.value;
              }
            });
          }
        }
      });

      // Handle form submission
      function handleProductFormSubmit(event) {
        // The form submission logic is now handled in the addEventListener above
        return true;
      }
    </script>

  </body>
</html>
<!-- prettier-ignore-end -->