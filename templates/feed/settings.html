{% load static %} {% load custom_filters %}
<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Configurações - Innovasus</title>
    <link
      href="https://cdn.boxicons.com/fonts/basic/boxicons.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="{% static 'styles/home.css' %}" />
    <link rel="stylesheet" href="{% static 'styles/settings.css' %}" />
  </head>
  <body>
    <!-- NAV -->
    {% include 'components/topbar.html' %}

    <div class="container">
      {% include 'components/sidebar.html' %}

      <!-- MAIN CONTENT -->
      <div class="main-content">
        <div class="settings-wrapper">
          <div class="settings-header">
            <div class="settings-banner"></div>
            <div class="settings-profile">
              <form
                method="post"
                enctype="multipart/form-data"
                action="{% url 'user:change_profile_picture' %}"
              >
                {% csrf_token %} {% if request.user.profile_picture %}
                <img
                  src="{{ request.user.profile_picture.url }}"
                  alt="Foto de Perfil"
                  class="settings-avatar btn-edit-main"
                />
                {% else %}
                <img
                  src="{% static 'assets/img/no_pic.jpg' %}"
                  alt="Foto de Perfil"
                  class="settings-avatar btn-edit-main"
                />
                {% endif %}
                <input
                  type="file"
                  id="id_profile_picture"
                  name="profile_picture"
                  accept="image/*"
                  style="display: none"
                  onchange="this.form.submit();"
                />
              </form>
              <div class="settings-info">
                <h2>{{ request.user.fullname }}</h2>
                {{ request.user.research_area}}{% if request.user.institution %}, {{ request.user.institution}}{% endif %}{% if request.user.cidade or request.user.estado %}<br><small style="color: #666;">{% if request.user.cidade %}{{ request.user.cidade }}{% endif %}{% if request.user.cidade and request.user.estado %}, {% endif %}{% if request.user.estado %}{{ request.user.estado }}{% endif %}</small>{% endif %}
              </div>
              <button
                type="button"
                class="btn-edit-main"
                onclick="document.getElementById('id_profile_picture').click();"
              >
                Editar imagem
              </button>
            </div>
          </div>
          <div class="settings-content">
            <div class="settings-card" id="area-card">
              <form
                method="post"
                enctype="multipart/form-data"
                class="settings-form"
                style="max-width: 400px; margin: 0 auto"
              >
                {% csrf_token %}
                <div style="margin-bottom: 16px">
                  <label
                    for="id_research_area_select"
                    style="
                      display: block;
                      font-weight: 500;
                      margin-bottom: 4px;
                      text-align: left;
                    "
                    >Título/Área de pesquisa</label
                  >
                  {{ area_form.research_area_select|add_class:'settings-input' }}
                  {{ area_form.research_area_custom|add_class:'settings-input' }}
                  {{ area_form.research_area }}
                </div>
                <div style="margin-bottom: 16px">
                  <label
                    for="id_institution"
                    style="
                      display: block;
                      font-weight: 500;
                      margin-bottom: 4px;
                      text-align: left;
                    "
                    >Instituição</label
                  >
                  {{ area_form.institution|add_class:'settings-input' }}
                </div>
                <div style="margin-bottom: 16px">
                  <label
                    for="id_estado"
                    style="
                      display: block;
                      font-weight: 500;
                      margin-bottom: 4px;
                      text-align: left;
                    "
                    >Estado</label
                  >
                  {{ area_form.estado|add_class:'settings-input' }}
                </div>
                <div style="margin-bottom: 16px">
                  <label
                    for="id_cidade"
                    style="
                      display: block;
                      font-weight: 500;
                      margin-bottom: 4px;
                      text-align: left;
                    "
                    >Cidade</label
                  >
                  {{ area_form.cidade|add_class:'settings-input' }}
                </div>
                <button
                  type="submit"
                  class="publish-btn active"
                  style="width: 100%"
                >
                  Salvar
                </button>
              </form>
            </div>
            <script></script>
            <!-- <div class="settings-card">
              <p><strong>Verificação de Pesquisador</strong><br /><a href="{% url 'feed:verificacao' %}"><p>clique para verificar</p></a></p>
              <button class="btn-edit">Editar</button>
            </div> -->
          </div>
        </div>
      </div>

      <!-- RIGHT SIDEBAR (invisível, mas mantém espaço para centralizar) -->
      <div class="right-sidebar" style="visibility: hidden"></div>
    </div>

    

    <script src="{% static 'js/settings.js' %}"></script>
    <script src="{% static 'js/home.js' %}"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function() {
        // Research area select functionality
        var researchAreaSelect = document.getElementById('research_area_select');
        var researchAreaCustom = document.getElementById('research_area_custom');
        var hiddenResearchArea = document.getElementById('id_research_area');
        
        if (researchAreaSelect && researchAreaCustom) {
          function toggleCustomInput() {
            if (researchAreaSelect.value === 'outro') {
              researchAreaCustom.style.display = 'block';
              researchAreaCustom.required = true;
            } else {
              researchAreaCustom.style.display = 'none';
              researchAreaCustom.required = false;
              researchAreaCustom.value = '';
            }
          }
          
          // Initialize on page load
          toggleCustomInput();
          
          // Handle changes
          researchAreaSelect.addEventListener('change', toggleCustomInput);
          
          // Handle form submission to set the hidden field value
          var form = document.querySelector('form');
          if (form) {
            form.addEventListener('submit', function() {
              if (researchAreaSelect.value === 'outro') {
                hiddenResearchArea.value = researchAreaCustom.value;
              } else {
                // Find the display name for the selected choice
                var selectedOption = researchAreaSelect.options[researchAreaSelect.selectedIndex];
                hiddenResearchArea.value = selectedOption.text;
              }
            });
          }
        }

      });
    </script>
  </body>
</html>
