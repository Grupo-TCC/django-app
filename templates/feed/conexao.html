{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Minhas Conex√µes - Innovator</title>
  <link rel="stylesheet" href="{% static 'styles/conexao.css' %}">
  <style>
    /* User name hover effects */
    .user-name-link {
      position: relative;
      color: inherit;
      text-decoration: underline;
      transition: color 0.3s ease;
    }
    
    .user-name-link:hover {
      color: #28a745 !important;
      text-decoration: none;
    }
    
    /* Tooltip for "ver perfil" */
    .user-name-link::after {
      content: "ver perfil";
      position: absolute;
      bottom: -25px;
      left: 50%;
      transform: translateX(-50%);
      background-color: #333;
      color: white;
      padding: 5px 8px;
      border-radius: 4px;
      font-size: 12px;
      white-space: nowrap;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
      z-index: 1000;
    }
    
    .user-name-link:hover::after {
      opacity: 1;
      visibility: visible;
    }
    
    /* Arrow for tooltip */
    .user-name-link::before {
      content: "";
      position: absolute;
      bottom: -15px;
      left: 50%;
      transform: translateX(-50%);
      border: 5px solid transparent;
      border-bottom-color: #333;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }
    
    .user-name-link:hover::before {
      opacity: 1;
      visibility: visible;
    }
  </style>
</head>
<body>
  {% include 'components/topbar.html' %}

  <div class="container">
    {% include 'components/sidebar.html' %}

<div class="main-content">
  
  <div class="artigos-header">
    <form method="get" class="search-box search-form" style="flex: 1">
      <input
        type="text"
        id="search-input"
        name="q"
        placeholder="Pesquisar pessoas"
        value="{{ search_query|default:'' }}"
        style="width: 100%; border: 1px solid #ccc; border-radius: 20px; padding: 10px 16px; outline: none;"
      />
    </form>
  </div>
  
  <!-- Lista de pessoas seguidas -->
  <div class="post-container">
    <h3>Pessoas que voc√™ segue</h3>
    <div class="seguindo-lista">
      {% with seguidos=0 %}
        {% for user in users %}
          {% if user.id in following_ids %}
            {% ifchanged %}{% with seguidos=1 %}{% endwith %}{% endifchanged %}
            <div class="seguindo-item" id="seguindo-{{ user.id }}">
              <img src="{{ user.get_profile_picture_url }}">
              <p><a href="{% url 'feed:perfil' user.id %}" class="user-name-link">{{ user.fullname }}</a></p>
              
              <button type="button" class="seguir-link follow-btn following" data-url="{% url 'feed:toggle_follow' user.id %}">Deixar de Seguir</button>
            </div>
          {% endif %}
        {% endfor %}
        {% if not following_ids or not users|yesno:'1,0' %}
          <p>Voc√™ ainda n√£o segue ningu√©m.</p>
        {% endif %}
      {% endwith %}
    </div>
  </div>

  <!-- Sugest√µes -->
  <div class="post-container">
    <h3>Sugest√µes para seguir</h3>
    <div class="sugestoes-grid">
      {% for user in users %}
        {% if user.id not in following_ids %}
          <div class="sugestao-card">
            <img src="{{ user.get_profile_picture_url }}">
            <h4><a href="{% url 'feed:perfil' user.id %}" class="user-name-link">{{ user.fullname }}</a></h4>
            <p class="research-area">{{ user.research_area|default:'√Årea de pesquisa n√£o informada' }}</p> 
            <p class="research-area">{{ user.institution|default:'Institui√ß√£o n√£o informada' }}</p>
            {% if user.cidade or user.estado %}
            <p class="research-area" style="font-size: 0.9em; color: #666;">
              üìç {% if user.cidade %}{{ user.cidade }}{% endif %}{% if user.cidade and user.estado %}, {% endif %}{% if user.estado %}{{ user.estado }}{% endif %}
            </p>
            {% endif %}
            <button type="button" class="seguir-link follow-btn" data-url="{% url 'feed:toggle_follow' user.id %}">Seguir</button>
          </div>
        {% endif %}
      {% empty %}
        <p>Nenhuma sugest√£o encontrada.</p>
      {% endfor %}
    </div>
  </div>
</div>


    <div class="right-sidebar">
      <div class="sidebar-title">
        <h4>Conversas</h4>
        <a href="#">Esconder conversa</a>
      </div>
      <div class="online-list">
        <div class="online"><img src="{% static 'assets/img/member-1.png' %}"></div>
        <p>Diva Luna</p>
      </div>
      <div class="online-list">
        <div class="online"><img src="{% static 'assets/img/member-2.png' %}"></div>
        <p>Lucas Brito</p>
      </div>
      <div class="online-list">
        <div class="online"><img src="{% static 'assets/img/member-3.png' %}"></div>
        <p>Leila Tales</p>
      </div>
    </div>
  </div>

  <script src="{% static 'js/home.js' %}"></script>
  <script src="{% static 'js/conexao.js' %}"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      var bell = document.getElementById('notification-bell');
      var dropdown = document.getElementById('notification-dropdown');
      if (bell && dropdown) {
        bell.addEventListener('click', function(e) {
          e.stopPropagation();
          dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
        });
        document.addEventListener('mousedown', function(e) {
          if (dropdown.style.display === 'block' && !dropdown.contains(e.target) && e.target !== bell) {
            dropdown.style.display = 'none';
          }
        });
      }
    });
  </script>
</body>
</html>
